# Тестовое задание ШИФТ ЦФТ

## Описание
Проект представляет собой RESTful API на языке Java, предназначенное для обработки интервалов чисел или букв. Основные функции приложения включают:

- Объединение пересекающихся интервалов.
- Сохранение непересекающихся интервалов в памяти SQL-базы данных (H2).
- Предоставление минимального интервала из базы данных по запросу.

## Конфигурация и запуск (Windows)
Для сборки и запуска потребуется Java 21 и git. Убедитесь, что они у вас установлены (+ прописаны в PATH) и выбрана нужная версия

Для проверки версии java в консоли прописать
```java --version```

1. Клонирование репозитория

```git clone https://github.com/MachineByte/cft-task-backend-api.git```

2. Переход в директорию проекта

```cd cft-task-backend-api```

3. Очистка билдов Gradle

```gradlew clean```для cmd

```./gradlew clean```для PowerShell

4. Автоматическая сборка и запуск приложения

```gradlew bootRun``` для cmd

```./gradlew bootRun``` для PowerShell

## Endpoints

### Добавление интервала из массивов целых чисел
```
/api/v1/intervals/merge?kind=digits
```

```
curl -X POST "http://localhost:8080/api/v1/intervals/merge?kind=digits" -H "Content-Type: application/json" -d "[[1, 4], [3, 6], [8, 10]]"
```

### Добавление интервала из массивов букв
```
/api/v1/intervals/merge?kind=letters
```
```
curl -X POST "http://localhost:8080/api/v1/intervals/merge?kind=letters" -H "Content-Type: application/json" -d "["a", "f"],["d", "j"],["r", "z"]"
```
### Запрос минимального целочисленного интервала
```
/api/v1/intervals/min?kind=digits
```
```
curl -X GET "http://localhost:8080/api/v1/intervals/min?kind=digits"
```
### Запрос минимального буквенного интервала
```
/api/v1/intervals/min?kind=letters
```
```
curl -X GET "http://localhost:8080/api/v1/intervals/min?kind=letters"
```
## Ссылки внутри приложения

### Swagger UI
```http://localhost:8080/swagger-ui/index.html#/```
### База данных H2
```http://localhost:8080/h2-console```

Для подключения нужно указать сделующие параметры. При этом приложение уже должно быть поднято
- `Driver class` org.h2.Driver
- `JDBC URL` jdbc:h2:mem:testdb
- `User name` sa
- `Password` оставить пустым

Таблицы в БД сгенерируются автоматически

## Описание внутренней работы приложения

### Компоненты
1. **Контроллер**: Принимает HTTP-запросы и передает их на обработку сервис-диспетчеру.
2. **Сервис-диспетчер**: Определяет тип запроса и перенаправляет его на соответствующий сервис или выбрасывает исключение.
3. **Сервисы для отдельных типов данных**: Обрабатывают запросы, вызывая статические методы утилитарных классов. Результаты сохраняются в базе данных или извлекаются из нее.
4. **Утилитарные классы**: предоставляют логику работы универсальную для любого типа данных

### Работа с исключениями
1. **Контроллер исключений**: принимает исключения всего приложения и отправляет их в виде DTO в формате статус-ошибка
2. **Отловщик исключений**: обрабатывает все иключения приложения и логирует их 

### Преимущества данных решений
1. **Упрощенное добавление новых типов данных**: Достаточно создать новый сервис и соответствующие сущности для работы с БД, без необходимости переписывать существующую логику работы с интервалами.
2. **Централизованная обработка запросов**: Сервис-диспетчер управляет маршрутизацией запросов, обеспечивая единую точку входа для любых типов данных.
3. **Улучшенная обработка исключений**: при возникновении исключений в результат запроса не нужно передавать ResponseEntity и вручную указывать сообщение и код ошибки. Все это делают всего 2 класса

### Особенности приложения
1. Было решено принимать `List<Object[]>` как request body первого эндпоинта потому, что данное решение позволяет
   использовать всего один эндпоинт для любых типов данных, что позволяет расширять приложение, оставляя сигнатуру эндпоинта прежней
2. При указании входного параметра для получения массива массивов как `List<Object[]>`,
   при передаче `List<char[]>` через endpoint он автоматически определяется как `List<String[]>`.
   В связи с этим в утилитарном классе для конвертации массива объектов в типизированный массив
   пришлось учитывать, что если передается `List<String[]>` (это определяется по первому элементу массива)
   и указан тип для конвертации `Character.class`, то будет использоваться первый символ строки как char.

## Диаграмма классов без учета исключений
![img_1.png](img_1.png)

## Технологии
- Java
- Spring Boot
- Spring Web
- Spring Data JPA
- JUnit5
- Mockito
- H2 Database
- Swagger


